{"version":3,"file":"src_app_pages_details_details_module_ts.js","mappings":"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","sources":["./src/app/pages/details/details-routing.module.ts","./src/app/pages/details/details.module.ts","./src/app/pages/details/details.page.ts","./src/app/pages/details/details.page.html"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { DetailsPage } from './details.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: DetailsPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class DetailsPageRoutingModule {}\r\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { DetailsPageRoutingModule } from './details-routing.module';\r\nimport { DetailsPage } from './details.page';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    DetailsPageRoutingModule,\r\n    TranslateModule.forChild()\r\n  ],\r\n  declarations: [DetailsPage],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class DetailsPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { Auth, updateEmail, updateProfile, User, GoogleAuthProvider, signInWithPopup, RecaptchaVerifier, PhoneAuthProvider, reauthenticateWithCredential, signInWithPhoneNumber, sendEmailVerification } from '@angular/fire/auth';\r\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { Router } from '@angular/router';\r\nimport { AvatarService } from 'src/app/services/avatar.service';\r\nimport { OverlayService } from 'src/app/services/overlay.service';\r\nimport { Geolocation } from '@capacitor/geolocation';\r\nimport { Camera, CameraResultType, CameraSource, Photo } from '@capacitor/camera';\r\nimport { ActionSheetController, AlertController, LoadingController, Platform } from '@ionic/angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { distinctUntilChanged, debounceTime } from 'rxjs/operators';\r\nimport { doc, setDoc, serverTimestamp, Firestore, getDoc } from '@angular/fire/firestore';\r\nimport { Drivers } from './../../interfaces/drivers';\r\nimport { geohashForLocation } from 'geofire-common';\r\n\r\n@Component({\r\n  selector: 'app-details',\r\n  templateUrl: './details.page.html',\r\n  styleUrls: ['./details.page.scss'],\r\n})\r\nexport class DetailsPage implements OnInit {\r\n  [x: string]: any;\r\n  form: FormGroup;\r\n  imageUrl: string;\r\n  imageDisplayUrl: string = '';\r\n  licenseDisplayUrl: string = '';\r\n  approve: boolean;\r\n  approve2: boolean;\r\n  user: User;\r\n  cartypes: import(\"@angular/fire/firestore\").DocumentData[] = [];\r\n  backButtonSubscription: any;\r\n  isSubmitting = false;\r\n  isUploading = false;\r\n  isUploadingLicense = false;\r\n\r\n  constructor(\r\n    private overlay: OverlayService,\r\n    private authy: Auth,\r\n    private avatar: AvatarService,\r\n    private router: Router,\r\n    private actionSheetController: ActionSheetController,\r\n    private alertController: AlertController,\r\n    private loadingController: LoadingController,\r\n    private platform: Platform,\r\n    private translate: TranslateService,\r\n    private firestore: Firestore\r\n  ) {\r\n    // Ensure the user is authenticated\r\n    this.authy.onAuthStateChanged((user) => {\r\n      if (user) {\r\n        this.user = user;\r\n        this.avatar.profile = user; // Ensure the profile is set\r\n        console.log(user.uid);\r\n        this.form.patchValue({\r\n          fullname: user.displayName?.split(' ')[0] || '',\r\n          lastname: user.displayName?.split(' ')[1] || '',\r\n          email: user.email || ''\r\n        });\r\n      }\r\n    });\r\n    this.avatar.getCartypes().subscribe({\r\n      next: (d) => {\r\n        console.log('Cartypes received:', d);\r\n        this.cartypes = d;\r\n      },\r\n      error: (error) => {\r\n        console.error('Failed to fetch cartypes:', error);\r\n        // Fallback to mock data if service fails\r\n        this.cartypes = [\r\n          { id: 'sedan', name: 'Sedan' },\r\n          { id: 'suv', name: 'SUV' },\r\n          { id: 'hatchback', name: 'Hatchback' },\r\n          { id: 'pickup', name: 'Pickup Truck' },\r\n          { id: 'van', name: 'Van' },\r\n          { id: 'coupe', name: 'Coupe' }\r\n        ];\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.initForm();\r\n    // Initialize with local default images for Android compatibility\r\n    if (!this.imageDisplayUrl) {\r\n      this.imageDisplayUrl = 'assets/imgs/about.svg';\r\n      this.imageUrl = 'assets/imgs/about.svg'; // Set the imageUrl for validation\r\n    }\r\n    if (!this.licenseDisplayUrl) {\r\n      this.licenseDisplayUrl = 'assets/icon/favicon.png';\r\n      // Set the form control value for license image\r\n      this.form.patchValue({\r\n        driverLicenseImage: 'assets/icon/favicon.png'\r\n      });\r\n    }\r\n\r\n    // Test connectivity on page load\r\n    this.testConnectivity();\r\n  }\r\n\r\n  async testConnectivity() {\r\n    try {\r\n      console.log('Testing Firebase connectivity...');\r\n      const isConnected = await this.avatar.testConnectivity();\r\n      console.log('Connectivity test result:', isConnected ? 'SUCCESS' : 'FAILED');\r\n    } catch (error) {\r\n      console.error('Connectivity test error:', error);\r\n    }\r\n  }\r\n\r\n  // Helper method to add timeout to promises\r\n  private withTimeout<T>(promise: Promise<T>, timeoutMs: number, errorMessage: string): Promise<T> {\r\n    return Promise.race([\r\n      promise,\r\n      new Promise<T>((_, reject) =>\r\n        setTimeout(() => reject(new Error(errorMessage)), timeoutMs)\r\n      )\r\n    ]);\r\n  }\r\n\r\n  // Method to reset form state in case of errors\r\n  private resetFormState() {\r\n    this.isSubmitting = false;\r\n    this.isUploading = false;\r\n    this.isUploadingLicense = false;\r\n  }\r\n\r\n  // Method to check if all required data is present for submission\r\n  isFormCompleteForSubmission(): boolean {\r\n    const formValid = this.form.valid;\r\n\r\n    // Accept both uploaded images (img_) and default images (assets/)\r\n    const hasProfileImage = this.imageUrl &&\r\n      (this.imageUrl.startsWith('img_') || this.imageUrl.startsWith('assets/'));\r\n\r\n    const licenseImageValue = this.form.get('driverLicenseImage')?.value;\r\n    const hasLicenseImage = licenseImageValue &&\r\n      (licenseImageValue.startsWith('img_') || licenseImageValue.startsWith('assets/'));\r\n\r\n    console.log('Form validation check:', {\r\n      formValid,\r\n      hasProfileImage,\r\n      hasLicenseImage,\r\n      imageUrl: this.imageUrl,\r\n      licenseImageValue: licenseImageValue\r\n    });\r\n\r\n    return formValid && hasProfileImage && hasLicenseImage;\r\n  }\r\n\r\n  private initForm() {\r\n    this.form = new FormGroup({\r\n      fullname: new FormControl('', {\r\n        validators: [\r\n          Validators.required,\r\n          Validators.minLength(2),\r\n          Validators.maxLength(50),\r\n          Validators.pattern('^[a-zA-Z ]*$')\r\n        ],\r\n        updateOn: 'change'\r\n      }),\r\n      lastname: new FormControl('', {\r\n        validators: [\r\n          Validators.required,\r\n          Validators.minLength(2),\r\n          Validators.maxLength(50),\r\n          Validators.pattern('^[a-zA-Z ]*$')\r\n        ],\r\n        updateOn: 'change'\r\n      }),\r\n      email: new FormControl('', {\r\n        validators: [\r\n          Validators.required,\r\n          Validators.email,\r\n          Validators.maxLength(100)\r\n        ],\r\n        updateOn: 'change'\r\n      }),\r\n      plateNumber: new FormControl('', {\r\n        validators: [\r\n          Validators.required,\r\n          Validators.minLength(2),\r\n          Validators.maxLength(10),\r\n          Validators.pattern('^[A-Z0-9- ]*$')\r\n        ]\r\n      }),\r\n      carType: new FormControl('', {\r\n        validators: [Validators.required]\r\n      }),\r\n      carName: new FormControl('', {\r\n        validators: [\r\n          Validators.required,\r\n          Validators.minLength(2),\r\n          Validators.maxLength(50)\r\n        ]\r\n      }),\r\n      mileage: new FormControl('', {\r\n        validators: [\r\n          Validators.required,\r\n          Validators.min(0),\r\n          Validators.max(999999)\r\n        ]\r\n      }),\r\n      driverLicense: new FormControl('', {\r\n        validators: [\r\n          Validators.required,\r\n          Validators.minLength(5),\r\n          Validators.maxLength(20),\r\n          Validators.pattern('^[A-Z0-9-]*$')\r\n        ]\r\n      }),\r\n      driverLicenseImage: new FormControl('')\r\n    });\r\n\r\n    // Monitor form changes with shorter debounce time\r\n    this.form.valueChanges\r\n      .pipe(\r\n        debounceTime(100),\r\n        distinctUntilChanged()\r\n      )\r\n      .subscribe(() => {\r\n        console.log('Form validity:', this.form.valid);\r\n      });\r\n\r\n    // Add status changes monitoring for immediate validation feedback\r\n    this.form.statusChanges\r\n      .pipe(\r\n        distinctUntilChanged()\r\n      )\r\n      .subscribe(status => {\r\n        console.log('Form status:', status);\r\n      });\r\n  }\r\n\r\n  async presentImageSourceActionSheet() {\r\n    const actionSheet = await this.actionSheetController.create({\r\n      header: await this.translate.get('DETAILS.PROFILE_INFO.UPLOAD_PHOTO').toPromise() || 'Upload Profile Photo',\r\n      buttons: [\r\n        {\r\n          text: await this.translate.get('DETAILS.BUTTONS.CAMERA').toPromise(),\r\n          icon: 'camera',\r\n          handler: () => {\r\n            this.getImage(CameraSource.Camera);\r\n          }\r\n        },\r\n        {\r\n          text: await this.translate.get('DETAILS.BUTTONS.GALLERY').toPromise(),\r\n          icon: 'images',\r\n          handler: () => {\r\n            this.getImage(CameraSource.Photos);\r\n          }\r\n        },\r\n        {\r\n          text: await this.translate.get('DETAILS.BUTTONS.FILE').toPromise(),\r\n          icon: 'document',\r\n          handler: () => {\r\n            this.getImage(CameraSource.Photos);\r\n          }\r\n        },\r\n        {\r\n          text: await this.translate.get('DETAILS.BUTTONS.CANCEL').toPromise(),\r\n          icon: 'close',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await actionSheet.present();\r\n  }\r\n\r\n  async getImage(source: CameraSource) {\r\n    const loading = await this.loadingController.create({\r\n      message: await this.translate.get('DETAILS.UPLOAD_STATUS.UPLOADING').toPromise() || 'Uploading image...'\r\n    });\r\n\r\n    try {\r\n      console.log('Getting profile photo from camera/gallery...');\r\n      const image = await Camera.getPhoto({\r\n        quality: 70,\r\n        allowEditing: true,\r\n        resultType: CameraResultType.Base64,\r\n        source: source,\r\n        width: 400 // Limit width to reduce size\r\n      });\r\n\r\n      if (image.base64String) {\r\n        await loading.present();\r\n        this.isUploading = true;\r\n\r\n        console.log('Compressing and storing image...');\r\n        // Store image and get reference with timeout\r\n        const imageReference = await this.withTimeout(\r\n          this.compressImageForFirebase(image, 'profile'),\r\n          30000,\r\n          'Image processing timed out. Please try with a smaller image.'\r\n        );\r\n        this.imageUrl = imageReference;\r\n\r\n        console.log('Getting display URL...');\r\n        // Get display URL for immediate preview\r\n        this.imageDisplayUrl = await this.getImageDataUrl(imageReference, 'profile');\r\n\r\n        // Trigger change detection for form validation\r\n        this.form.updateValueAndValidity();\r\n\r\n        console.log('Profile image stored successfully with reference:', imageReference);\r\n\r\n        const successAlert = await this.alertController.create({\r\n          header: await this.translate.get('COMMON.SUCCESS').toPromise() || 'Success',\r\n          message: await this.translate.get('DETAILS.ALERTS.PROFILE_UPLOAD_SUCCESS').toPromise() || 'Profile image uploaded successfully!',\r\n          buttons: ['OK']\r\n        });\r\n        await successAlert.present();\r\n      } else {\r\n        throw new Error('No image data received from camera');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('getImage error:', error);\r\n\r\n      let message = 'Upload failed. Please try again.';\r\n\r\n      if (error.message?.includes('User cancelled')) {\r\n        // Don't show error for user cancellation\r\n        return;\r\n      } else if (error.message?.includes('Photo URL is required') || error.message?.includes('too big')) {\r\n        message = await this.translate.get('DETAILS.ALERTS.IMAGE_TOO_BIG').toPromise() || 'The image is too big. Please try another image with a smaller size.';\r\n      } else if (error.message?.includes('Permission')) {\r\n        message = 'Camera permission is required. Please enable camera access in your device settings.';\r\n      } else if (error.message?.includes('network') || error.message?.includes('Network')) {\r\n        message = 'Network error. Please check your internet connection and try again.';\r\n      } else {\r\n        message = await this.translate.get('DETAILS.ALERTS.UPLOAD_FAILED').toPromise() || `Upload failed: ${error.message || 'Unknown error'}`;\r\n      }\r\n\r\n      const alert = await this.alertController.create({\r\n        header: await this.translate.get('DETAILS.ALERTS.UPLOAD_FAILED').toPromise() || 'Upload Failed',\r\n        message: message,\r\n        buttons: ['OK'],\r\n      });\r\n      await alert.present();\r\n    } finally {\r\n      this.isUploading = false;\r\n      try {\r\n        await loading.dismiss();\r\n      } catch (dismissError) {\r\n        console.warn('Error dismissing loading:', dismissError);\r\n      }\r\n    }\r\n  }\r\n\r\n  async updateProfile() {\r\n    if (!this.isFormCompleteForSubmission() || this.isSubmitting) {\r\n      this.markFormGroupTouched(this.form);\r\n      return;\r\n    }\r\n\r\n    this.isSubmitting = true;\r\n    let loading = await this.loadingController.create({\r\n      message: await this.translate.get('COMMON.PLEASE_WAIT').toPromise() || 'Please wait...'\r\n    });\r\n\r\n    try {\r\n      await loading.present();\r\n      console.log('Starting profile update process...');\r\n\r\n      // Validate profile image (accept both uploaded and default images)\r\n      if (!this.imageUrl || (!this.imageUrl.startsWith('img_') && !this.imageUrl.startsWith('assets/'))) {\r\n        throw new Error('Profile photo is required');\r\n      }\r\n\r\n      // Validate license image (accept both uploaded and default images)\r\n      const licenseImageUrl = this.form.get('driverLicenseImage')?.value;\r\n      if (!licenseImageUrl || (!licenseImageUrl.startsWith('img_') && !licenseImageUrl.startsWith('assets/'))) {\r\n        throw new Error('Driver license photo is required');\r\n      }\r\n\r\n      // Store current user reference\r\n      const currentUser = this.authy.currentUser;\r\n      if (!currentUser) {\r\n        throw new Error('No authenticated user found. Please log in again.');\r\n      }\r\n\r\n      console.log('Updating Firebase Auth profile...');\r\n      // Update profile (use a local asset for Firebase Auth since we store actual images in Firestore)\r\n      await updateProfile(currentUser, {\r\n        displayName: `${this.form.value.fullname} ${this.form.value.lastname}`,\r\n        photoURL: `assets/imgs/about.svg`,\r\n      });\r\n\r\n      const carInfo = {\r\n        plateNumber: this.form.value.plateNumber,\r\n        carType: this.form.value.carType,\r\n        carName: this.form.value.carName,\r\n        mileage: this.form.value.mileage,\r\n      };\r\n\r\n      const driverInfo = {\r\n        driverLicense: this.form.value.driverLicense,\r\n        driverLicenseImage: this.form.value.driverLicenseImage,\r\n      };\r\n\r\n      console.log('Checking location permissions...');\r\n      const permissionStatus = await Geolocation.checkPermissions();\r\n      console.log('Location permission status:', permissionStatus);\r\n\r\n      if (permissionStatus.location !== 'granted') {\r\n        console.log('Requesting location permissions...');\r\n        const requestResult = await Geolocation.requestPermissions();\r\n        if (requestResult.location !== 'granted') {\r\n          throw new Error('Location permission is required to register as a driver. Please enable location access in your device settings.');\r\n        }\r\n      }\r\n\r\n      console.log('Getting current location...');\r\n      const coordinates = await this.withTimeout(\r\n        Geolocation.getCurrentPosition({\r\n          enableHighAccuracy: false,\r\n          timeout: 15000\r\n        }),\r\n        20000,\r\n        'Location request timed out. Please ensure GPS is enabled and try again.'\r\n      );\r\n      console.log('Location obtained:', coordinates);\r\n\r\n      console.log('Creating driver profile...');\r\n      // Use stored user reference with timeout\r\n      await this.withTimeout(\r\n        this.avatar.createNewDriver(\r\n          coordinates,\r\n          this.form.value.fullname + ' ' + this.form.value.lastname,\r\n          this.form.value.email,\r\n          currentUser.phoneNumber,\r\n          carInfo.carName,\r\n          carInfo.carType,\r\n          carInfo.plateNumber,\r\n          this.imageUrl,\r\n          driverInfo.driverLicenseImage,\r\n          driverInfo.driverLicense,\r\n          carInfo.mileage\r\n        ),\r\n        30000,\r\n        'Driver profile creation timed out. Please check your internet connection and try again.'\r\n      );\r\n\r\n      console.log('Creating payment card...');\r\n      await this.withTimeout(\r\n        this.avatar.createCard('Cash', '0', 'cash', 'None'),\r\n        10000,\r\n        'Payment card creation timed out. Please try again.'\r\n      );\r\n      this.approve2 = false;\r\n\r\n      console.log('Profile update completed successfully. Navigating to tabs...');\r\n      // Navigate after successful update\r\n      await this.router.navigateByUrl('tabs', { replaceUrl: true });\r\n\r\n    } catch (error: any) {\r\n      console.error('Profile update error:', error);\r\n\r\n      // Determine specific error message\r\n      let errorMessage = 'An unexpected error occurred. Please try again.';\r\n\r\n      if (error.message) {\r\n        errorMessage = error.message;\r\n      } else if (error.code) {\r\n        switch (error.code) {\r\n          case 'auth/network-request-failed':\r\n            errorMessage = 'Network error. Please check your internet connection and try again.';\r\n            break;\r\n          case 'auth/too-many-requests':\r\n            errorMessage = 'Too many requests. Please wait a moment and try again.';\r\n            break;\r\n          case 'permission-denied':\r\n            errorMessage = 'Permission denied. Please check your account permissions.';\r\n            break;\r\n          case 'unavailable':\r\n            errorMessage = 'Service temporarily unavailable. Please try again later.';\r\n            break;\r\n          default:\r\n            errorMessage = `Error (${error.code}): ${error.message || 'Unknown error occurred'}`;\r\n        }\r\n      }\r\n\r\n      // Show detailed error alert\r\n      const alert = await this.alertController.create({\r\n        header: 'Registration Failed',\r\n        message: errorMessage,\r\n        buttons: [\r\n          {\r\n            text: 'OK',\r\n            role: 'cancel'\r\n          },\r\n          {\r\n            text: 'Retry',\r\n            handler: () => {\r\n              // Allow user to retry\r\n              setTimeout(() => {\r\n                this.updateProfile();\r\n              }, 1000);\r\n            }\r\n          }\r\n        ]\r\n      });\r\n      await alert.present();\r\n\r\n    } finally {\r\n      this.resetFormState();\r\n      if (loading) {\r\n        try {\r\n          await loading.dismiss();\r\n        } catch (dismissError) {\r\n          console.warn('Error dismissing loading:', dismissError);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  async selectDriverLicenseImage() {\r\n    const actionSheet = await this.actionSheetController.create({\r\n      header: await this.translate.get('DETAILS.LICENSE_INFO.UPLOAD_PHOTO').toPromise(),\r\n      buttons: [\r\n        {\r\n          text: await this.translate.get('DETAILS.BUTTONS.CAMERA').toPromise(),\r\n          icon: 'camera',\r\n          handler: () => {\r\n            this.getLicenseImage(CameraSource.Camera);\r\n          }\r\n        },\r\n        {\r\n          text: await this.translate.get('DETAILS.BUTTONS.GALLERY').toPromise(),\r\n          icon: 'images',\r\n          handler: () => {\r\n            this.getLicenseImage(CameraSource.Photos);\r\n          }\r\n        },\r\n        {\r\n          text: await this.translate.get('DETAILS.BUTTONS.FILE').toPromise(),\r\n          icon: 'document',\r\n          handler: () => {\r\n            this.getLicenseImage(CameraSource.Photos);\r\n          }\r\n        },\r\n        {\r\n          text: await this.translate.get('DETAILS.BUTTONS.CANCEL').toPromise(),\r\n          icon: 'close',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await actionSheet.present();\r\n  }\r\n\r\n  async getLicenseImage(source: CameraSource) {\r\n    const loading = await this.loadingController.create({\r\n      message: await this.translate.get('DETAILS.UPLOAD_STATUS.UPLOADING').toPromise() || 'Uploading image...'\r\n    });\r\n\r\n    try {\r\n      console.log('Getting license photo from camera/gallery...');\r\n      const image = await Camera.getPhoto({\r\n        quality: 70,\r\n        allowEditing: true,\r\n        resultType: CameraResultType.Base64,\r\n        source: source,\r\n        width: 400 // Limit width to reduce size\r\n      });\r\n\r\n      if (image.base64String) {\r\n        await loading.present();\r\n        this.isUploadingLicense = true;\r\n\r\n        // Store image and get reference\r\n        const imageReference = await this.compressImageForFirebase(image, 'license');\r\n        this.form.patchValue({\r\n          driverLicenseImage: imageReference\r\n        });\r\n\r\n        // Get display URL for immediate preview\r\n        this.licenseDisplayUrl = await this.getImageDataUrl(imageReference, 'license');\r\n\r\n        // Trigger change detection for form validation\r\n        this.form.updateValueAndValidity();\r\n\r\n        console.log('License image stored successfully with reference:', imageReference);\r\n\r\n        const successAlert = await this.alertController.create({\r\n          header: await this.translate.get('COMMON.SUCCESS').toPromise() || 'Success',\r\n          message: await this.translate.get('DETAILS.ALERTS.LICENSE_UPLOAD_SUCCESS').toPromise() || 'License image uploaded successfully!',\r\n          buttons: ['OK']\r\n        });\r\n        await successAlert.present();\r\n      }\r\n    } catch (error) {\r\n      console.error('getLicenseImage error:', error);\r\n      const message = error.message?.includes('Photo URL is required')\r\n        ? await this.translate.get('DETAILS.ALERTS.IMAGE_TOO_BIG').toPromise() || 'The image is too big. Please try another image with a smaller size.'\r\n        : await this.translate.get('DETAILS.ALERTS.UPLOAD_FAILED').toPromise() || `Upload failed: ${error.message || 'Unknown error'}`;\r\n\r\n      const alert = await this.alertController.create({\r\n        header: await this.translate.get('DETAILS.ALERTS.UPLOAD_FAILED').toPromise() || 'Upload Failed',\r\n        message: message,\r\n        buttons: ['OK'],\r\n      });\r\n      await alert.present();\r\n    } finally {\r\n      this.isUploadingLicense = false;\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  private async compressImageForFirebase(image: Photo, type: 'profile' | 'license'): Promise<string> {\r\n    try {\r\n      if (!image.base64String) {\r\n        throw new Error('No image data provided');\r\n      }\r\n\r\n      if (!this.user?.uid) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n\r\n      // Store the full-quality compressed image in Firestore for actual use\r\n      const fullQualityBase64 = await this.compressImage(image.base64String, 0.8, 800, 600);\r\n\r\n      // Store full image in Firestore\r\n      const timestamp = Date.now();\r\n      const imageId = `${type}_${timestamp}`;\r\n      const imageDocRef = doc(this.firestore, `drivers/${this.user.uid}/images/${imageId}`);\r\n\r\n      await setDoc(imageDocRef, {\r\n        imageData: fullQualityBase64,\r\n        type: type,\r\n        uploadedAt: serverTimestamp(),\r\n        uploadedBy: this.user.uid\r\n      });\r\n\r\n      // Return a reference ID that we can use to retrieve the full image\r\n      const imageReference = `img_${this.user.uid}_${imageId}`;\r\n\r\n      console.log('Image stored in Firestore with ID:', imageReference);\r\n      console.log('Full quality image size:', fullQualityBase64.length, 'characters');\r\n\r\n      return imageReference;\r\n    } catch (error) {\r\n      console.error('Error processing image:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Method to retrieve actual image data for display\r\n  async getImageDataUrl(imageReference: string, type: 'profile' | 'license' = 'profile'): Promise<string> {\r\n    try {\r\n      // Handle default images\r\n      if (!imageReference || imageReference === 'default_profile') {\r\n        return 'assets/imgs/about.svg';\r\n      }\r\n\r\n      if (imageReference === 'default_license') {\r\n        return 'assets/icon/favicon.png';\r\n      }\r\n\r\n      if (!imageReference.startsWith('img_')) {\r\n        // Return appropriate default based on type\r\n        return type === 'profile' ? 'assets/imgs/about.svg' : 'assets/icon/favicon.png';\r\n      }\r\n\r\n      // Extract user ID and image ID from reference\r\n      const parts = imageReference.split('_');\r\n      if (parts.length < 3) {\r\n        return type === 'profile' ? 'assets/imgs/about.svg' : 'assets/icon/favicon.png';\r\n      }\r\n\r\n      const userId = parts[1];\r\n      const imageId = parts.slice(2).join('_');\r\n\r\n      // Get image from Firestore\r\n      const imageDocRef = doc(this.firestore, `drivers/${userId}/images/${imageId}`);\r\n      const imageDoc = await getDoc(imageDocRef);\r\n\r\n      if (imageDoc.exists()) {\r\n        const data = imageDoc.data();\r\n        return `data:image/jpeg;base64,${data.imageData}`;\r\n      }\r\n\r\n      // Return default if image not found\r\n      return type === 'profile' ? 'assets/imgs/about.svg' : 'assets/icon/favicon.png';\r\n    } catch (error) {\r\n      console.error('Error retrieving image:', error);\r\n      // Return default on error\r\n      return type === 'profile' ? 'assets/imgs/about.svg' : 'assets/icon/favicon.png';\r\n    }\r\n  }\r\n\r\n  private async compressImage(base64: string, quality: number = 0.7, maxWidth: number = 800, maxHeight: number = 600): Promise<string> {\r\n    return new Promise((resolve, reject) => {\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      const img = new Image();\r\n\r\n      img.onload = () => {\r\n        // Calculate new dimensions\r\n        let { width, height } = img;\r\n\r\n        if (width > height) {\r\n          if (width > maxWidth) {\r\n            height = (height * maxWidth) / width;\r\n            width = maxWidth;\r\n          }\r\n        } else {\r\n          if (height > maxHeight) {\r\n            width = (width * maxHeight) / height;\r\n            height = maxHeight;\r\n          }\r\n        }\r\n\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n\r\n        // Draw and compress\r\n        ctx.drawImage(img, 0, 0, width, height);\r\n        const compressedBase64 = canvas.toDataURL('image/jpeg', quality).split(',')[1];\r\n\r\n        console.log('Image compressed from', base64.length, 'to', compressedBase64.length, 'characters');\r\n        resolve(compressedBase64);\r\n      };\r\n\r\n      img.onerror = () => reject(new Error('Failed to load image for compression'));\r\n      img.src = `data:image/jpeg;base64,${base64}`;\r\n    });\r\n  }\r\n\r\n  private markFormGroupTouched(formGroup: FormGroup) {\r\n    Object.values(formGroup.controls).forEach(control => {\r\n      control.markAsTouched();\r\n      if (control instanceof FormGroup) {\r\n        this.markFormGroupTouched(control);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getErrorMessage(error: any): string {\r\n    if (error.message) {\r\n      return error.message;\r\n    }\r\n\r\n    switch (error.code) {\r\n      case 'auth/requires-recent-login':\r\n        return 'Please re-authenticate to update your email';\r\n      case 'auth/email-already-in-use':\r\n        return 'This email is already registered';\r\n      case 'auth/invalid-email':\r\n        return 'Please enter a valid email address';\r\n      case 'auth/operation-not-allowed':\r\n        return 'Email verification is required before changing email';\r\n      case 'auth/network-request-failed':\r\n        return 'Network error. Please check your internet connection.';\r\n      case 'auth/too-many-requests':\r\n        return 'Too many requests. Please wait and try again.';\r\n      case 'permission-denied':\r\n        return 'Permission denied. Please check your account permissions.';\r\n      case 'unavailable':\r\n        return 'Service temporarily unavailable. Please try again later.';\r\n      case 'failed-precondition':\r\n        return 'Database operation failed. Please try again.';\r\n      default:\r\n        return error.toString() || 'An unexpected error occurred';\r\n    }\r\n  }\r\n}","<ion-header>\r\n  <ion-toolbar>\r\n    <ion-title>{{ 'DETAILS.TITLE' | translate }}</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding custom-content\">\r\n  <form [formGroup]=\"form\">\r\n    <!-- Profile Image Section -->\r\n    <div class=\"profile-image-section\">\r\n      <div class=\"image-container\" (click)=\"presentImageSourceActionSheet()\">\r\n        <ng-container *ngIf=\"!isUploading; else uploadingTemplate\">\r\n          <img [src]=\"imageDisplayUrl\" *ngIf=\"imageDisplayUrl\" alt=\"Profile photo\">\r\n          <div class=\"placeholder\" *ngIf=\"!imageDisplayUrl\">\r\n            <ion-icon name=\"person\"></ion-icon>\r\n          </div>\r\n          <div class=\"overlay\">\r\n            <ion-icon name=\"camera\"></ion-icon>\r\n          </div>\r\n        </ng-container>\r\n        <ng-template #uploadingTemplate>\r\n          <div class=\"upload-loader\">\r\n            <ion-spinner name=\"circular\"></ion-spinner>\r\n            <p>{{ 'DETAILS.UPLOAD_STATUS.UPLOADING' | translate }}</p>\r\n          </div>\r\n        </ng-template>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Rest of the form with updated styling -->\r\n    <div class=\"form-container\">\r\n      <ion-list>\r\n        <!-- Personal Information -->\r\n        <ion-item-group class=\"custom-group\">\r\n          <ion-item-divider>\r\n            <ion-label>{{ 'DETAILS.PERSONAL_INFO.TITLE' | translate }}</ion-label>\r\n          </ion-item-divider>\r\n\r\n          <ion-item [class.ion-invalid]=\"form.get('fullname')?.touched && form.get('fullname')?.invalid\">\r\n            <ion-label position=\"floating\">{{ 'DETAILS.PERSONAL_INFO.FIRST_NAME' | translate }}</ion-label>\r\n            <ion-input formControlName=\"fullname\" type=\"text\">\r\n            </ion-input>\r\n            <ion-note slot=\"error\" *ngIf=\"form.get('fullname')?.touched && form.get('fullname')?.errors?.['required']\">\r\n              {{ 'VALIDATION.REQUIRED' | translate }}\r\n            </ion-note>\r\n          </ion-item>\r\n\r\n          <ion-item>\r\n            <ion-input formControlName=\"lastname\" [placeholder]=\"'DETAILS.PERSONAL_INFO.LAST_NAME' | translate\">\r\n            </ion-input>\r\n          </ion-item>\r\n\r\n          <ion-item>\r\n            <ion-input formControlName=\"email\" type=\"email\" [placeholder]=\"'DETAILS.PERSONAL_INFO.EMAIL' | translate\">\r\n            </ion-input>\r\n          </ion-item>\r\n        </ion-item-group>\r\n\r\n        <!-- Vehicle Information -->\r\n        <ion-item-group class=\"custom-group\">\r\n          <ion-item-divider>\r\n            <ion-label>{{ 'DETAILS.VEHICLE_INFO.TITLE' | translate }}</ion-label>\r\n          </ion-item-divider>\r\n          <ion-item>\r\n            <ion-input formControlName=\"plateNumber\" [placeholder]=\"'DETAILS.VEHICLE_INFO.PLATE_NUMBER' | translate\">\r\n            </ion-input>\r\n          </ion-item>\r\n\r\n          <ion-item>\r\n            <ion-select formControlName=\"carType\" [placeholder]=\"'DETAILS.VEHICLE_INFO.CAR_TYPE' | translate\">\r\n              <ion-select-option *ngFor=\"let type of cartypes\" [value]=\"type.id\">\r\n                {{type.name}}\r\n              </ion-select-option>\r\n            </ion-select>\r\n          </ion-item>\r\n\r\n          <ion-item>\r\n            <ion-input formControlName=\"carName\" [placeholder]=\"'DETAILS.VEHICLE_INFO.CAR_NAME' | translate\">\r\n            </ion-input>\r\n          </ion-item>\r\n\r\n          <ion-item>\r\n            <ion-input formControlName=\"mileage\" type=\"number\"\r\n              [placeholder]=\"'DETAILS.VEHICLE_INFO.MILEAGE' | translate\">\r\n            </ion-input>\r\n          </ion-item>\r\n        </ion-item-group>\r\n\r\n        <!-- License Information -->\r\n        <ion-item-group class=\"custom-group\">\r\n          <ion-item-divider>\r\n            <ion-label>{{ 'DETAILS.LICENSE_INFO.TITLE' | translate }}</ion-label>\r\n          </ion-item-divider>\r\n\r\n          <ion-item>\r\n            <ion-input formControlName=\"driverLicense\" [placeholder]=\"'DETAILS.LICENSE_INFO.NUMBER' | translate\">\r\n            </ion-input>\r\n          </ion-item>\r\n\r\n          <!-- License Image Preview -->\r\n          <div class=\"license-image-section\">\r\n            <div class=\"license-image-container\" (click)=\"selectDriverLicenseImage()\">\r\n              <ng-container *ngIf=\"!isUploadingLicense; else licenseUploadingTemplate\">\r\n                <img [src]=\"licenseDisplayUrl\" *ngIf=\"licenseDisplayUrl\" alt=\"License photo\">\r\n                <div class=\"placeholder\" *ngIf=\"!licenseDisplayUrl\">\r\n                  <ion-icon name=\"id-card\"></ion-icon>\r\n                  <p>{{ 'DETAILS.LICENSE_INFO.TAP_TO_UPLOAD' | translate }}</p>\r\n                </div>\r\n                <div class=\"overlay\" *ngIf=\"licenseDisplayUrl\">\r\n                  <ion-icon name=\"camera\"></ion-icon>\r\n                </div>\r\n              </ng-container>\r\n              <ng-template #licenseUploadingTemplate>\r\n                <div class=\"upload-loader\">\r\n                  <ion-spinner name=\"circular\"></ion-spinner>\r\n                  <p>{{ 'DETAILS.UPLOAD_STATUS.UPLOADING' | translate }}</p>\r\n                </div>\r\n              </ng-template>\r\n            </div>\r\n          </div>\r\n        </ion-item-group>\r\n      </ion-list>\r\n    </div>\r\n\r\n    <div class=\"submit-section\">\r\n      <ion-button expand=\"block\" (click)=\"updateProfile()\" [disabled]=\"!isFormCompleteForSubmission() || isSubmitting\"\r\n        class=\"submit-button\">\r\n        <ion-icon name=\"save\" slot=\"start\"></ion-icon>\r\n        {{ 'DETAILS.BUTTONS.SUBMIT' | translate }}\r\n        <ion-spinner name=\"crescent\" *ngIf=\"isSubmitting\"></ion-spinner>\r\n      </ion-button>\r\n      \r\n      <!-- Debug info - remove this in production -->\r\n      <div style=\"margin-top: 10px; font-size: 12px; color: #666;\" *ngIf=\"!isFormCompleteForSubmission()\">\r\n        <p>Missing requirements:</p>\r\n        <p *ngIf=\"!form.valid\"> Form validation incomplete</p>\r\n        <p *ngIf=\"!imageUrl || (!imageUrl.startsWith('img_') && !imageUrl.startsWith('assets/'))\"> Profile photo required</p>\r\n        <p *ngIf=\"!form.get('driverLicenseImage')?.value || (!form.get('driverLicenseImage')?.value.startsWith('img_') && !form.get('driverLicenseImage')?.value.startsWith('assets/'))\"> License photo required</p>\r\n      </div>\r\n\r\n      <!-- Connectivity test button - remove in production -->\r\n      <ion-button fill=\"clear\" size=\"small\" (click)=\"testConnectivity()\" style=\"margin-top: 10px;\">\r\n        <ion-icon name=\"wifi\" slot=\"start\"></ion-icon>\r\n        Test Firebase Connection\r\n      </ion-button>\r\n    </div>\r\n  </form>\r\n</ion-content>"],"names":["Auth","updateProfile","User","FormControl","FormGroup","Validators","Geolocation","Camera","CameraResultType","CameraSource","distinctUntilChanged","debounceTime","doc","setDoc","serverTimestamp","getDoc","i0","DetailsPage","constructor","overlay","authy","avatar","router","actionSheetController","alertController","loadingController","platform","translate","firestore","onAuthStateChanged","user","profile","console","log","uid","form","patchValue","fullname","displayName","split","lastname","email","getCartypes","subscribe","next","d","cartypes","error","id","name","ngOnInit","initForm","imageDisplayUrl","imageUrl","licenseDisplayUrl","driverLicenseImage","testConnectivity","isConnected","withTimeout","promise","timeoutMs","errorMessage","Promise","race","_","reject","setTimeout","Error","resetFormState","isSubmitting","isUploading","isUploadingLicense","isFormCompleteForSubmission","formValid","valid","hasProfileImage","startsWith","licenseImageValue","get","value","hasLicenseImage","validators","required","minLength","maxLength","pattern","updateOn","plateNumber","carType","carName","mileage","min","max","driverLicense","valueChanges","pipe","statusChanges","status","presentImageSourceActionSheet","actionSheet","create","header","toPromise","buttons","text","icon","handler","getImage","Photos","role","present","source","loading","message","image","getPhoto","quality","allowEditing","resultType","Base64","width","base64String","imageReference","compressImageForFirebase","getImageDataUrl","updateValueAndValidity","successAlert","includes","alert","dismiss","dismissError","warn","markFormGroupTouched","licenseImageUrl","currentUser","photoURL","carInfo","driverInfo","permissionStatus","checkPermissions","location","requestResult","requestPermissions","coordinates","getCurrentPosition","enableHighAccuracy","timeout","createNewDriver","phoneNumber","createCard","approve2","navigateByUrl","replaceUrl","code","selectDriverLicenseImage","getLicenseImage","type","fullQualityBase64","compressImage","timestamp","Date","now","imageId","imageDocRef","imageData","uploadedAt","uploadedBy","length","parts","userId","slice","join","imageDoc","exists","data","base64","maxWidth","maxHeight","resolve","canvas","document","createElement","ctx","getContext","img","Image","onload","height","drawImage","compressedBase64","toDataURL","onerror","src","formGroup","Object","values","controls","forEach","control","markAsTouched","getErrorMessage","toString","selectors","decls","vars","consts","template","_r1","_r6"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}